jQuery.fn.farbtastic=function(t){return $.farbtastic(this,t),this},jQuery.farbtastic=function(t,e){return(t=$(t).get(0)).farbtastic||(t.farbtastic=new jQuery._farbtastic(t,e))},jQuery._farbtastic=function(t,e){var i=this;$(t).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var o=$(".farbtastic",t);i.wheel=$(".wheel",t).get(0),i.radius=84,i.square=100,i.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",o).each(function(){if("none"!=this.currentStyle.backgroundImage){var t=this.currentStyle.backgroundImage;t=this.currentStyle.backgroundImage.substring(5,t.length-2),$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+t+"')"})}}),i.linkTo=function(t){return"object"==typeof i.callback&&$(i.callback).unbind("keyup",i.updateValue),i.color=null,"function"==typeof t?i.callback=t:"object"!=typeof t&&"string"!=typeof t||(i.callback=$(t),i.callback.bind("keyup",i.updateValue),i.callback.get(0).value&&i.setColor(i.callback.get(0).value)),this},i.updateValue=function(t){this.value&&this.value!=i.color&&i.setColor(this.value)},i.setColor=function(t){var e=i.unpack(t);return i.color!=t&&e&&(i.color=t,i.rgb=e,i.hsl=i.RGBToHSL(i.rgb),i.updateDisplay()),this},i.setHSL=function(t){return i.hsl=t,i.rgb=i.HSLToRGB(t),i.color=i.pack(i.rgb),i.updateDisplay(),this},i.widgetCoords=function(t){var e,o,a=t.target||t.srcElement,r=i.wheel;if(void 0!==t.offsetX){for(var s={x:t.offsetX,y:t.offsetY},n=a;n;)n.mouseX=s.x,n.mouseY=s.y,s.x+=n.offsetLeft,s.y+=n.offsetTop,n=n.offsetParent;n=r;for(var u={x:0,y:0};n;){if(void 0!==n.mouseX){e=n.mouseX-u.x,o=n.mouseY-u.y;break}u.x+=n.offsetLeft,u.y+=n.offsetTop,n=n.offsetParent}for(n=a;n;)n.mouseX=void 0,n.mouseY=void 0,n=n.offsetParent}else{s=i.absolutePosition(r);e=(t.pageX||0*(t.clientX+$("html").get(0).scrollLeft))-s.x,o=(t.pageY||0*(t.clientY+$("html").get(0).scrollTop))-s.y}return{x:e-i.width/2,y:o-i.width/2}},i.mousedown=function(t){document.dragging||($(document).bind("mousemove",i.mousemove).bind("mouseup",i.mouseup),document.dragging=!0);var e=i.widgetCoords(t);return i.circleDrag=2*Math.max(Math.abs(e.x),Math.abs(e.y))>i.square,i.mousemove(t),!1},i.mousemove=function(t){var e=i.widgetCoords(t);if(i.circleDrag){var o=Math.atan2(e.x,-e.y)/6.28;o<0&&(o+=1),i.setHSL([o,i.hsl[1],i.hsl[2]])}else{var a=Math.max(0,Math.min(1,-e.x/i.square+.5)),r=Math.max(0,Math.min(1,-e.y/i.square+.5));i.setHSL([i.hsl[0],a,r])}return!1},i.mouseup=function(){$(document).unbind("mousemove",i.mousemove),$(document).unbind("mouseup",i.mouseup),document.dragging=!1},i.updateDisplay=function(){var t=6.28*i.hsl[0];$(".h-marker",o).css({left:Math.round(Math.sin(t)*i.radius+i.width/2)+"px",top:Math.round(-Math.cos(t)*i.radius+i.width/2)+"px"}),$(".sl-marker",o).css({left:Math.round(i.square*(.5-i.hsl[1])+i.width/2)+"px",top:Math.round(i.square*(.5-i.hsl[2])+i.width/2)+"px"}),$(".color",o).css("backgroundColor",i.pack(i.HSLToRGB([i.hsl[0],1,.5]))),"object"==typeof i.callback?($(i.callback).css({backgroundColor:i.color,color:.5<i.hsl[2]?"#000":"#fff"}),$(i.callback).each(function(){this.value&&this.value!=i.color&&(this.value=i.color)})):"function"==typeof i.callback&&i.callback.call(i,i.color)},i.absolutePosition=function(t){var e={x:t.offsetLeft,y:t.offsetTop};if(t.offsetParent){var o=i.absolutePosition(t.offsetParent);e.x+=o.x,e.y+=o.y}return e},i.pack=function(t){var e=Math.round(255*t[0]),o=Math.round(255*t[1]),a=Math.round(255*t[2]);return"#"+(e<16?"0":"")+e.toString(16)+(o<16?"0":"")+o.toString(16)+(a<16?"0":"")+a.toString(16)},i.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0},i.HSLToRGB=function(t){var e,o,a=t[0],r=t[1],s=t[2];return e=2*s-(o=s<=.5?s*(r+1):s+r-s*r),[this.hueToRGB(e,o,a+.33333),this.hueToRGB(e,o,a),this.hueToRGB(e,o,a-.33333)]},i.hueToRGB=function(t,e,o){return 6*(o=o<0?o+1:1<o?o-1:o)<1?t+(e-t)*o*6:2*o<1?e:3*o<2?t+(e-t)*(.66666-o)*6:t},i.RGBToHSL=function(t){var e,o,a,r,s,n,u=t[0],i=t[1],c=t[2];return e=Math.min(u,Math.min(i,c)),a=(o=Math.max(u,Math.max(i,c)))-e,(s=0)<(n=(e+o)/2)&&n<1&&(s=a/(n<.5?2*n:2-2*n)),(r=0)<a&&(o==u&&o!=i&&(r+=(i-c)/a),o==i&&o!=c&&(r+=2+(c-u)/a),o==c&&o!=u&&(r+=4+(u-i)/a),r/=6),[r,s,n]},$("*",o).mousedown(i.mousedown),i.setColor("#000000"),e&&i.linkTo(e)};